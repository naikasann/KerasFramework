# train

## 概要

Kerasの学習部分のプログラム．
カテゴリを判別するようなものの骨組みを作成している．
学習での設定はconfig.yamlで行う．

--------------

## ファイル構成

- /datasetgenerator --- データセット用のジェネレータを作成するクラス
- /mymodel --- モデル生成・コンパイルを行うためのクラス
- /processingresults --- 実行結果を出力するときや、その出力準備のクラス
- /setcallback --- keras callbackを設定するクラス
- /result --- 実行結果が残るためのフォルダー
- config.yaml --- 学習の設定を行うためのコンフィグファイル
- train.py --- 学習の実行ファイル(mainファイル)
- analyze_test.ipynb --- jupyter notebookで実行するテストプログラム

--------------

## 実行方法

### 学習

train.pyがあるディレクトリから

``` command prompt
python train.py
```

で学習を開始する．
学習の設定方法は`config.yaml`を参照して学習を行う．
設定の方法は別のREADMEに記述する．

またlearningschedulerはtrain.pyの中で設定を行うことができる。

### テスト

analyze_test.ipynbがあるディレクトリから

``` command prompt
jupyter notebook
```

で実行し`analyze_test.ipynb`を選択し、実行していくことで精度を出すことができる。
また詳細的な結果を出すことができる。

- テストで用いる画像の出力
- モデルサマリー
- 正解率、再現率などのclassification report
- 誤答した問題や正解した問題の数の出力(回答のフィルター)
- Grad Camの出力(tensorflow2系)

--------------

## datasetについて

config.yamlに学習方法を記載するがデータセットの読み取り部分のみややこしいためここに記載する．
現在作成したジェネレーターは3種類で，読み取り方法は以下のとおりである．

### text

テキストファイルを読み取ってそこから画像ファイル，ラベルをジェネレーターに登録していく．
テキストファイルの中身は

``` dataset.txt
[画像ファイルへのパス] [カテゴリの番号(0から始まる数値)]
[画像ファイルへのパス] [カテゴリの番号(0から始まる数値)]
[画像ファイルへのパス] [カテゴリの番号(0から始まる数値)]
...
```

で作成する．カテゴリの指定等はconfig.yamlに書き込みする．
config.yamlにはテキストファイルを指定し記述する．
構成は自由．(テキストファイルをしっかり書ければ．)

### onefolder

一つのフォルダーにすべての画像群を入れ，そこから画像・ラベルを読み取る．
画像ファイルの名前から各カテゴリに割り振るように構築してある．
(名前のつけ方を誤ると学習がうまくいかない．)
画像の名前(各カテゴリ)はconfig.yamlに設定する．

フォルダー内は

``` folder
[catogory名]_識別名.[画像拡張子]
[catogory名]_識別名.[画像拡張子]
[catogory名]_識別名.[画像拡張子]
```

で構築することをお勧めする．
config.yamlにはフォルダーを指定し記述する．
構成は

``` folder
[指定ディレクトリ]---[画像ファイル]
                 |-[画像ファイル]
                 |-[画像ファイル]
                 ...
```

となっている．

### folder

各フォルダーにカテゴリ名を記述．そのフォルダーに各カテゴリに該当する画像群を保存していく．
構成は

``` folder
[指定ディレクトリ]---[カテゴリ名のフォルダー]---[画像ファイル]
                  |                         [画像ファイル]
                  |                         ...
                  |-[カテゴリ名のフォルダー]---[画像ファイル]
                  |                       ---[画像ファイル]
                  |                         ...
                  ...
```

となっている
